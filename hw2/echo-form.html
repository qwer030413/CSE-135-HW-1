<!DOCTYPE html>
<html>
<head>
    <title>Echo form</title>
    <style>
        label { display: block; margin-top: 30px; }
        textarea { width: 100%; height: 100px; }
    </style>
</head>

<body>
   <h1>echo form </h1>
   <noscript>
    <form method="POST" action = "php/echo-php.php">
    <label>Enter Data (key=value&key2=value2):
        <input type="text" name="data" placeholder="name=John&age=30">
    </label>
    <input type="submit" value="Submit">
    </form>
    <p>Enable JS for full thing</p>
   </noscript>

   <form id="echoForm">
        <label>
            Language and Endpoint:
            <select id="language">
                <option value="php/echo-php.php">PHP - General</option>
                <option value="php/echo-get-php.php">PHP - GET</option>
                <option value="php/echo-post-php.php">PHP - POST</option>
                
            </select>
        </label>
        <label>
            Encoding (Content-Type):
            <select id="encoding">
                <option value="application/x-www-form-urlencoded">Form URL Encoded</option>
                <option value="application/json">JSON</option>
            </select>
        </label>
        <label>
            HTTP Method:
            <select id="method">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
        </label>

        <label>
            Data json:
            <textarea id="data"></textarea>
        </label>

        <button type="submit">Submit</button>
    </form>
    <script>
        document.getElementById('echoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const endpoint = document.getElementById('language').value;
            const method = document.getElementById('method').value;
            const rawData = document.getElementById('data').value.trim();
            const encoding = document.getElementById('encoding').value;
            let url = endpoint;
            let options = {
                method,
                headers: {}
            };

            if (method === 'GET') {
                if (rawData) {
                    url += '?' + rawData;
                }
            } else {
                if(encoding == 'application/json'){
                    options.headers['Content-Type'] = 'application/json';
                    options.body = rawData;
                }
                else{
                    options.headers['Content-Type'] = 'application/x-www-form-urlencoded';
                    options.body = rawData;
                }
            }

            const response = await fetch(url, options);
            const text = await response.text();
            document.open();
            document.write(text);
            document.close();
        });
    </script>
</body>
</html>